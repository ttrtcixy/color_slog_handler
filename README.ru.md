# –í—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ Slog —Å —Ü–≤–µ—Ç–æ–≤–æ–π –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π
–ë—ã—Å—Ç—Ä—ã–π `slog.Handler` –¥–ª—è Go. –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∫—Ä–∞—Å–∏–≤—ã–π —Ü–≤–µ—Ç–Ω–æ–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π –≤—ã–≤–æ–¥, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—É—é –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—é –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤ –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏, —Ç–∞–∫–∏–µ –∫–∞–∫ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.
## ‚ö†Ô∏è –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ –æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
* **–¶–µ–ª–µ–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**: –≠—Ç–æ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –¥–ª—è **–ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏**. –ò–∑-–∑–∞ –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É —Ü–≤–µ—Ç–æ–≤ ANSI –æ–Ω –ø—Ä–∏–º–µ—Ä–Ω–æ **–≤ 3 —Ä–∞–∑–∞ –º–µ–¥–ª–µ–Ω–Ω–µ–µ**, —á–µ–º –µ—Å–ª–∏ –æ—Ç–∫–ª—é—á–∏—Ç—å –≤ –Ω–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞.
* **–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ**: –í—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–∞—è **JSON-–≤–µ—Ä—Å–∏—è** (–±–µ–∑ —Ü–≤–µ—Ç–æ–≤—ã—Ö –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤) –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –≤ —Å–ª–µ–¥—É—é—â–µ–º –≤—ã–ø—É—Å–∫–µ.
* **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ slog**: –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—Å–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ `slog.Logger` (–≥—Ä—É–ø–ø—ã, –∞—Ç—Ä–∏–±—É—Ç—ã, –∫–æ–Ω—Ç–µ–∫—Å—Ç) **–∑–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º `slog.LogValuer`** (—Å–∫–æ—Ä–æ).
## üöÄ –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
* **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `sync.Pool` –¥–ª—è –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ –≤—ã–¥–µ–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏ –≤ –∫—É—á–µ.
* **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è**: –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è `bufio` —Å —Ñ–æ–Ω–æ–≤–æ–π –ø–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º–æ–π –æ—á–∏—Å—Ç–∫–∏ –¥–ª—è —Å—Ä–µ–¥ —Å –≤—ã—Å–æ–∫–æ–π –ø—Ä–æ–ø—É—Å–∫–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å—é.
* **–ê—Ç—Ä–∏–±—É—Ç—ã —Å —É—á–µ—Ç–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞**: –í–Ω–µ–¥—Ä—è–π—Ç–µ –∞—Ç—Ä–∏–±—É—Ç—ã –∂—É—Ä–Ω–∞–ª–∞ –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –≤ `context.Context` (–¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏–ª–∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏).
* **–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–µ —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≥–ª–∞–∂–∏–≤–∞–µ—Ç –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã `slog.Group` –≤ —á–∏—Å—Ç—ã–µ –∫–ª—é—á–∏ —Å —Ç–æ—á–µ—á–Ω–æ–π –Ω–æ—Ç–∞—Ü–∏–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, `db.conn.id=5`).
* **–ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å**: –ê—Ç–æ–º–∞—Ä–Ω—ã–µ —Ñ–ª–∞–≥–∏ –∏ –∑–∞—â–∏—Ç–∞ –º—å—é—Ç–µ–∫—Å–∞–º–∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –±–µ–∑–æ–ø–∞—Å–Ω—É—é —Ä–∞–±–æ—Ç—É –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã.
* **–¶–≤–µ—Ç–Ω–æ–π –≤—ã–≤–æ–¥**: –í—ã—Å–æ–∫–∞—è –≤–∏–¥–∏–º–æ—Å—Ç—å —Ü–≤–µ—Ç–æ–≤ ANSI –¥–ª—è –º–µ—Ç–æ–∫ –≤—Ä–µ–º–µ–Ω–∏, —É—Ä–æ–≤–Ω–µ–π –∂—É—Ä–Ω–∞–ª–∞ –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö.
## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞
```shell
go get github.com/ttrtcixy/color-slog-handler
```
## üõ† –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
```go
package main
import (
	"context"
	"log/slog"
	"os"
)
func main() {
	cfg := &Config{
		Level:          int(slog.LevelDebug),
		BufferedOutput: true, // Enables background flushing
	}
	handler := NewTextHandler(os.Stdout, cfg)
	logger := slog.New(handler)
	// Important: Close the handler to stop the flusher and flush remaining logs
	defer handler.Close(context.Background())
	logger.Info("User logged in", "user_id", 42, "status", "active")
}
```
–õ–µ–≥–∫–æ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ –∞—Ç—Ä–∏–±—É—Ç—ã —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç, –Ω–µ –∏–∑–º–µ–Ω—è—è —Å–∏–≥–Ω–∞—Ç—É—Ä—É –∫–∞–∂–¥–æ–π —Ñ—É–Ω–∫—Ü–∏–∏:
```go
// Add attributes to context
ctx := AppendAttrsToCtx(context.Background(), slog.String("trace_id", "af82-bx22"))
// The logger will automatically pick them up
logger.InfoContext(ctx, "processing request")
// Output: 14:05:01 | INFO | processing request trace_id=af82-bx22
```
## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
–°—Ç—Ä—É–∫—Ç—É—Ä–∞ `Config` –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å—Ä–µ–¥—ã —á–µ—Ä–µ–∑ —Ç–µ–≥–∏:
* `Level`: –£—Ä–æ–≤–µ–Ω—å –≤–µ–¥–µ–Ω–∏—è –∂—É—Ä–Ω–∞–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, Debug=-4, Info=0).
* `BufferedOutput`: –í–∫–ª—é—á–∏—Ç—å/–û—Ç–∫–ª—é—á–∏—Ç—å –±—É—Ñ–µ—Ä 4 –ö–ë —Å –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–π –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ—á–∏—Å—Ç–∫–æ–π.
## ‚ö†Ô∏è –í–∞–∂–Ω–æ–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏–µ –æ –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–∏
–ï—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ `BufferedOutput: true`, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–∑–≤–∞—Ç—å `handler.Close(ctx)`:
* –û–Ω –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ñ–æ–Ω–æ–≤—É—é –ø–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º—É –æ—á–∏—Å—Ç–∫–∏.
* –û–Ω –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –≤—Å–µ –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –∂—É—Ä–Ω–∞–ª—ã –≤ –±—É—Ñ–µ—Ä–µ —Ä–∞–∑–º–µ—Ä–æ–º 4096 –±–∞–π—Ç –±—É–¥—É—Ç –∑–∞–ø–∏—Å–∞–Ω—ã –≤ –≤—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.
–í—ã–∑–æ–≤ `Close()` –¥–ª—è –Ω–µ –±—É—Ñ–µ—Ä–µ–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –≤–µ—Ä–Ω–µ—Ç `ErrNothingToClose`.
## üõ£ –î–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—ã–≤–æ–¥–∞ JSON —Å —Ç–æ–π –∂–µ –ª–æ–≥–∏–∫–æ–π –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–∏.
* –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ `slog.LogValuer`.
